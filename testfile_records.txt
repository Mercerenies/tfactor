
# This is basically what record types will "desugar" too.

mod MyFunType
end

fun make-my-fun-type ( Int Int -- Any )
  2 "MyFunType" Primitives.unsafe-record-construct
end

fun get-first-slot ( Any -- Int )
  0 Primitives.unsafe-record-get Primitives.unsafe1
end

record Vector3
  constructor make
  field x Int
  field y Int
  field z Int

  fun dot ( Vector3 Vector3 -- Int )
    [ [ 1 ] dip2 [ Vector3.x * ] dup bi* ]
    [ [ 1 ] dip2 [ Vector3.y * ] dup bi* ]
    [ [ 1 ] dip2 [ Vector3.z * ] dup bi* ]
    tri2 + +
  end

end

fun main ( -- Int Any Int Vector3 Int )
  10 20 make-my-fun-type [ get-first-slot ] keep
  100 200 300 Vector3.make [ Vector3.x ] keep
  1 2 3 Vector3.make 1 3 2 Vector3.make Vector3.dot
end
